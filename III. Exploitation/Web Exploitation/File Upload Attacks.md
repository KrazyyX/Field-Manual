
# Cheatsheet

| ***Wordlists to Use***                                                                                                                          | ***Usage***                                                            |
| ----------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| [PHP extensions list](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Extension%20PHP/extensions.lst) |                                                                        |
| [.NET Extensions list](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/Extension%20ASP)               |                                                                        |
| `/Discovery/Web-Content/web-extensions.txt`                                                                                                     | Contains some extensions from both.                                    |
| `Discovery/Web-Content/web-all-content-types.txt`                                                                                               | To fuzz all web content types to see which gives a different response. |

# Overview

# Methodology

#### 1. Upload a php webshell without attempting any bypasses

We do this to check if the has any filters enabled.

#### 2. Bypassing Client Side Validation

This can be done either by:

1. deleting/modifying the `html` or `js` of the page to allow for `.php`
2. sending a legit request and intercepting it through a proxy, modifying its contents (to a webshell, for example).

#### 3. Bypassing Blacklist Filters

Fuzz using the PHP/.NET extensions to see which ones get a different response.

**NOTE**: make sure to turn off `URL-encode` if using burp.
#### 4. Bypassing White Filters

Apply double extensions, or reverse double extensions.

Example: `image.jpeg.php`
#### 5. Character Injection

Fuzz with the following wordlist

```shell
for char in '%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' 'â€¦' ':'; do
    for ext in '.php' '.phps'; do
        echo "shell$char$ext.jpg" >> wordlist.txt
        echo "shell$ext$char.jpg" >> wordlist.txt
        echo "shell.jpg$char$ext" >> wordlist.txt
        echo "shell.jpg$ext$char" >> wordlist.txt
    done
done
```

#### 6. Bypassing Validation

If the server does content type validation:
Fuzz `Content-type:` header for ones that produce a different response.

Change MIME-type of the file being uploaded.

[Magic Bytes Converter](https://gist.github.com/Techbrunch/56415c360daf4d039975267586c45d8c): Appends them to the start of a file.
[Magic Bytes List](https://gist.github.com/leommoore/f9e57ba2aa4bf197ebc5)

# Other File Upload Attacks
## XSS
example:
```shell
exiftool -Comment=' "><img src=1 onerror=alert(window.origin)>' HTB.jpg
```

Change MIME-type to `text/html` and this would run

# Cross-Site Scripting
